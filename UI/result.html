<html>
    <head>
        <title>ParlyHack (Team: Whip)</title>
        
        <!-- Bootstrap CSS -->
        <link href="css/bootstrap.min.css" rel="stylesheet" />
        <link href="css/bootstrap-responsive.min.css" rel="stylesheet" />
        
        <!-- Bootstrap JS --> 
        <script src="js/jquery-latest.js"></script>
        <script src="js/jquery.center.js"></script>
        <script src="js/bootstrap.min.js"></script>
        
        <!-- project js and css -->
        <script src="js/parly.js"></script>
        <script src="js/champion-api.js"></script>
        <link href="css/parly.css" rel="stylesheet" />
        
        <script>

            $(function() {
                var vars = getUrlVars();
                var id = vars['uid'];
                
                $('#cancelretrieve').click(function() {
                    window.location = 'search.html';
                });
                
                retrieveMPdata(id);
            });

            function retrieveMPdata(id) {
               spinner(true);
                
                $.ajax({
                  url: generate_MP_details_URL(id),
                  dataType: 'json',
                  success: function(data) { spinner(false); showResults(data); },
                  error: function() { console.log('Error'); spinner(false); showErrorMsg(); }
                });
            }
            
            function showErrorMsg() {
                $('#error-message').show();
            }
            
            function showResults(data) {
                dumpResults(data);
                
                var MP_name = data['firstname'] + ' ' + data['lastname'];
                var MP_constituency = data['constituency'];
                var MP_img_url = 'http://www.theyworkforyou.com' + data['TWFYimage']; MP_img_url.replace('\\', '');
                var MP_twfy_id = data['TWFYid'];
                var MP_twfy_url = 'http://www.theyworkforyou.com/mp/' + data['firstname'] + '_' + data['lastname'];
                var MP_enteredhouse = data['enteredhouse'];
                var MP_depts = data['depts'];
                var MP_subjects = data['subjects'];
                var MP_expenses2009 = data['expenses2009'];
                
                $('#photo').attr('src', MP_img_url);
                $('span.name').text(MP_name);
                $('span.constituency').text(MP_constituency);
                $('#enteredhouse').text(MP_enteredhouse);
                $('#open-twfy-btn').attr('href', MP_twfy_url);
                $('#open-twfy-btn').attr('target', '_blank');
                $('#open-twfy-btn').removeClass('disabled');
                $('#depts').text(MP_depts);
                $('#subjects').text(MP_subjects);
                $('#expenses2009').text(MP_expenses2009);
            }
            
        </script>
        
        <style>
            img.photo {
                width: auto;
                height: 256px;
            }
        </style>
    </head>
    <body>
        
        <div class="navbar">
          <div class="navbar-inner">
            <a class="brand" href="champion.html">Champion</a>
            <ul class="nav">
              <li class="active"><a href="search.html">Search</a></li>
              <li><a href="team.html">Team</a></li>
              <li><a href="data-sources.html">Sources</a></li>
            </ul>
          </div>
        </div>  

        <ul class="breadcrumb">
            <li><a href="champion.html">Champion</a> <span class="divider">/</span></li>
            <li><a href="search.html">Search</a> <span class="divider">/</span></li>
            <li class="active"><a href="#">Result</a></li>
        </ul>

        <!-- the searching spinner -->
        <div id="spinner" class="modal hide fade" data-backdrop="static" data-keyboard="false">
          <div class="modal-header">
            <!--<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>-->
            <h3>Retrieving data...</h3>
          </div>
          <div class="modal-body">
            <p><img src="images/spinner.gif" style="float: left; margin-right: 10px;" />
                Please wait while we retrieve data about your selected candidate.
            </p>
          </div>
          <div class="modal-footer">
            <a id="cancelretrieve" href="#" class="btn btn-primary">Cancel</a>
          </div>
        </div>
        
        <div class="alert alert-error" id="error-message" style="display: none;">
            An error occurred retrieving data about this MP.
            Please try again by hitting refresh.
        </div>
        
        <div class="row-fluid">
            <div class="span8 padded">
                <div class="hero-unit">
                    <div class="row-fluid">
                        <div class="span6" style="text-align: center;">
                            <div class="polaroid">
                                <p><span class="name" /></p>
                                <img src="images/user_256x256.png" class="photo" id="photo" />
                            </div>
                        </div>
                        <div class="span6">
                            <h1>
                                <span class="name">Name</span>
                                <small><span class="constituency">Constituency</span></small>
                            </h1>
                            <p>Most recently elected on <span id="enteredhouse">(date)</span></p>
                            <p>
                                <a href="#" id="open-twfy-btn" class="btn disabled">
                                    <i class="icon-globe"></i> They work for you...
                                </a>
                            </p>
                        </div>
                    </div>
                </div>
                
            </div>
            
            <div class="span4 padded">

                <p><b>Expenses claimed in 2009: &pound;<span id="expenses2009">(sum)</span></b></p>

                <p><span class="name"></span> has written to the following departments:</p>
                <p><b><span id="depts">(departments)</span></b></p>
                <p>on the following topics:</p>
                <p><b><span id="subjects">(topics)</span></b></p>
                
            </div>
        </div><!-- /row -->
 
    </body>
</html>